# Glimpse ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ê°€ì´ë“œ

## ğŸ“Š ê°œìš”

íš¨ê³¼ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê¹…ì€ ì„œë¹„ìŠ¤ì˜ ì•ˆì •ì„±ê³¼ ì„±ëŠ¥ì„ ìœ ì§€í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” Glimpse ì„œë¹„ìŠ¤ì˜ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•ê³¼ ë¡œê·¸ ê´€ë¦¬ ì „ëµì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ— ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Grafana Dashboard                         â”‚
â”‚                  (ì‹œê°í™” ë° ì•Œë¦¼ ê´€ë¦¬)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Prometheus                               â”‚
â”‚                  (ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node.js  â”‚   â”‚PostgreSQLâ”‚   â”‚  Redis   â”‚   â”‚CloudWatch  â”‚
â”‚ Exporter  â”‚   â”‚ Exporter â”‚   â”‚ Exporter â”‚   â”‚ Exporter   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API     â”‚   â”‚    DB    â”‚   â”‚  Cache   â”‚   â”‚    AWS     â”‚
â”‚  Server   â”‚   â”‚  Server  â”‚   â”‚  Server  â”‚   â”‚ Resources  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­

#### Prometheus ì„¤ì • (server/src/monitoring/metrics.ts)
```typescript
import { Registry, Counter, Histogram, Gauge } from 'prom-client';

// ë©”íŠ¸ë¦­ ë ˆì§€ìŠ¤íŠ¸ë¦¬
export const register = new Registry();

// HTTP ìš”ì²­ ì¹´ìš´í„°
export const httpRequestsTotal = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status'],
  registers: [register]
});

// HTTP ìš”ì²­ ì§€ì† ì‹œê°„
export const httpRequestDuration = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status'],
  buckets: [0.1, 0.3, 0.5, 0.7, 1, 3, 5, 7, 10],
  registers: [register]
});

// í™œì„± ì‚¬ìš©ì ìˆ˜
export const activeUsers = new Gauge({
  name: 'active_users',
  help: 'Number of active users',
  registers: [register]
});

// WebSocket ì—°ê²° ìˆ˜
export const websocketConnections = new Gauge({
  name: 'websocket_connections',
  help: 'Number of active WebSocket connections',
  registers: [register]
});

// ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
export const businessMetrics = {
  likesTotal: new Counter({
    name: 'likes_total',
    help: 'Total number of likes sent',
    labelNames: ['type'],
    registers: [register]
  }),
  
  matchesTotal: new Counter({
    name: 'matches_total',
    help: 'Total number of matches created',
    registers: [register]
  }),
  
  paymentsTotal: new Counter({
    name: 'payments_total',
    help: 'Total number of payments',
    labelNames: ['type', 'status'],
    registers: [register]
  }),
  
  revenue: new Counter({
    name: 'revenue_total_krw',
    help: 'Total revenue in KRW',
    labelNames: ['type'],
    registers: [register]
  })
};
```

#### Express ë¯¸ë“¤ì›¨ì–´ (server/src/middleware/monitoring.ts)
```typescript
import { Request, Response, NextFunction } from 'express';
import { httpRequestsTotal, httpRequestDuration } from '../monitoring/metrics';

export const metricsMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    const route = req.route?.path || 'unknown';
    const method = req.method;
    const status = res.statusCode.toString();
    
    httpRequestsTotal.inc({ method, route, status });
    httpRequestDuration.observe({ method, route, status }, duration);
  });
  
  next();
};

// Prometheus ì—”ë“œí¬ì¸íŠ¸
export const metricsEndpoint = async (req: Request, res: Response) => {
  res.set('Content-Type', register.contentType);
  const metrics = await register.metrics();
  res.end(metrics);
};
```

### 2. ì¸í”„ë¼ ë©”íŠ¸ë¦­

#### Node.js í”„ë¡œì„¸ìŠ¤ ë©”íŠ¸ë¦­
```typescript
import { collectDefaultMetrics } from 'prom-client';

// ê¸°ë³¸ Node.js ë©”íŠ¸ë¦­ ìˆ˜ì§‘
collectDefaultMetrics({
  register,
  prefix: 'glimpse_',
  gcDurationBuckets: [0.001, 0.01, 0.1, 1, 2, 5],
  eventLoopMonitoringPrecision: 10
});

// ì»¤ìŠ¤í…€ í”„ë¡œì„¸ìŠ¤ ë©”íŠ¸ë¦­
export const processMetrics = {
  memoryUsage: new Gauge({
    name: 'process_memory_usage_bytes',
    help: 'Process memory usage',
    labelNames: ['type'],
    collect() {
      const mem = process.memoryUsage();
      this.set({ type: 'rss' }, mem.rss);
      this.set({ type: 'heapTotal' }, mem.heapTotal);
      this.set({ type: 'heapUsed' }, mem.heapUsed);
      this.set({ type: 'external' }, mem.external);
    },
    registers: [register]
  })
};
```

#### ë°ì´í„°ë² ì´ìŠ¤ ë©”íŠ¸ë¦­
```sql
-- PostgreSQL ëª¨ë‹ˆí„°ë§ ë·°
CREATE VIEW v_database_metrics AS
SELECT 
  (SELECT count(*) FROM pg_stat_activity) as active_connections,
  (SELECT count(*) FROM pg_stat_activity WHERE state = 'active') as active_queries,
  (SELECT count(*) FROM pg_stat_activity WHERE wait_event IS NOT NULL) as waiting_queries,
  (SELECT sum(numbackends) FROM pg_stat_database) as total_connections,
  (SELECT sum(xact_commit) FROM pg_stat_database) as total_commits,
  (SELECT sum(xact_rollback) FROM pg_stat_database) as total_rollbacks,
  (SELECT sum(blks_hit)::float / (sum(blks_hit) + sum(blks_read)) FROM pg_stat_database) as cache_hit_ratio;
```

### 3. Grafana ëŒ€ì‹œë³´ë“œ ì„¤ì •

#### ë©”ì¸ ëŒ€ì‹œë³´ë“œ (grafana/dashboards/main.json)
```json
{
  "dashboard": {
    "title": "Glimpse Production Dashboard",
    "panels": [
      {
        "title": "Request Rate",
        "targets": [{
          "expr": "sum(rate(http_requests_total[5m])) by (status)"
        }],
        "type": "graph",
        "alert": {
          "conditions": [{
            "evaluator": {
              "params": [100],
              "type": "gt"
            },
            "query": {
              "params": ["A", "5m", "now"]
            },
            "reducer": {
              "params": [],
              "type": "avg"
            },
            "type": "query"
          }]
        }
      },
      {
        "title": "Response Time (95th percentile)",
        "targets": [{
          "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))"
        }],
        "type": "graph"
      },
      {
        "title": "Active Users",
        "targets": [{
          "expr": "active_users"
        }],
        "type": "stat"
      },
      {
        "title": "Error Rate",
        "targets": [{
          "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m])) * 100"
        }],
        "type": "graph",
        "thresholds": [{
          "value": 1,
          "color": "yellow"
        }, {
          "value": 5,
          "color": "red"
        }]
      }
    ]
  }
}
```

## ğŸ“ ë¡œê¹… ì‹œìŠ¤í…œ

### 1. ë¡œê¹… êµ¬ì¡°

#### Winston ì„¤ì • (server/src/utils/logger.ts)
```typescript
import winston from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';

// ë¡œê·¸ ë ˆë²¨ ì •ì˜
const levels = {
  error: 0,
  warn: 1,
  info: 2,
  http: 3,
  debug: 4,
};

// ë¡œê·¸ í¬ë§·
const format = winston.format.combine(
  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss:ms' }),
  winston.format.errors({ stack: true }),
  winston.format.splat(),
  winston.format.json()
);

// ê°œë°œ í™˜ê²½ í¬ë§·
const devFormat = winston.format.combine(
  winston.format.colorize(),
  winston.format.printf(({ timestamp, level, message, ...metadata }) => {
    let msg = `${timestamp} [${level}] : ${message}`;
    if (Object.keys(metadata).length > 0) {
      msg += ` ${JSON.stringify(metadata)}`;
    }
    return msg;
  })
);

// íŠ¸ëœìŠ¤í¬íŠ¸ ì„¤ì •
const transports: winston.transport[] = [
  // ì½˜ì†” ì¶œë ¥
  new winston.transports.Console({
    format: process.env.NODE_ENV === 'development' ? devFormat : format,
  }),
  
  // ì—ëŸ¬ ë¡œê·¸ íŒŒì¼
  new DailyRotateFile({
    filename: 'logs/error-%DATE%.log',
    datePattern: 'YYYY-MM-DD',
    level: 'error',
    maxSize: '20m',
    maxFiles: '30d',
    format,
  }),
  
  // ì „ì²´ ë¡œê·¸ íŒŒì¼
  new DailyRotateFile({
    filename: 'logs/combined-%DATE%.log',
    datePattern: 'YYYY-MM-DD',
    maxSize: '100m',
    maxFiles: '14d',
    format,
  }),
];

// ë¡œê±° ìƒì„±
export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  levels,
  format,
  transports,
  exceptionHandlers: [
    new winston.transports.File({ filename: 'logs/exceptions.log' })
  ],
  rejectionHandlers: [
    new winston.transports.File({ filename: 'logs/rejections.log' })
  ],
});

// êµ¬ì¡°í™”ëœ ë¡œê¹… í—¬í¼
export const log = {
  error: (message: string, error?: Error, metadata?: any) => {
    logger.error(message, {
      error: error?.message,
      stack: error?.stack,
      ...metadata,
    });
  },
  
  warn: (message: string, metadata?: any) => {
    logger.warn(message, metadata);
  },
  
  info: (message: string, metadata?: any) => {
    logger.info(message, metadata);
  },
  
  http: (req: Request, res: Response, responseTime: number) => {
    logger.http('HTTP Request', {
      method: req.method,
      url: req.url,
      status: res.statusCode,
      responseTime,
      userAgent: req.get('user-agent'),
      ip: req.ip,
      userId: req.user?.id,
    });
  },
  
  debug: (message: string, metadata?: any) => {
    logger.debug(message, metadata);
  },
};
```

### 2. ë¡œê·¸ ìˆ˜ì§‘ ë° ë¶„ì„

#### ELK Stack êµ¬ì„± (docker-compose.logging.yml)
```yaml
version: '3.8'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.12.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
    volumes:
      - es_data:/usr/share/elasticsearch/data
    ports:
      - "9200:9200"

  logstash:
    image: docker.elastic.co/logstash/logstash:8.12.0
    volumes:
      - ./logstash/pipeline:/usr/share/logstash/pipeline
      - ./logs:/logs
    environment:
      - "LS_JAVA_OPTS=-Xmx256m -Xms256m"
    depends_on:
      - elasticsearch

  kibana:
    image: docker.elastic.co/kibana/kibana:8.12.0
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch

  filebeat:
    image: docker.elastic.co/beats/filebeat:8.12.0
    volumes:
      - ./filebeat/filebeat.yml:/usr/share/filebeat/filebeat.yml
      - ./logs:/logs
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - elasticsearch
      - logstash

volumes:
  es_data:
```

#### Logstash íŒŒì´í”„ë¼ì¸ (logstash/pipeline/logstash.conf)
```ruby
input {
  beats {
    port => 5044
  }
  
  file {
    path => "/logs/*.log"
    start_position => "beginning"
    codec => "json"
  }
}

filter {
  # JSON íŒŒì‹±
  json {
    source => "message"
  }
  
  # íƒ€ì„ìŠ¤íƒ¬í”„ íŒŒì‹±
  date {
    match => [ "timestamp", "yyyy-MM-dd HH:mm:ss:SSS" ]
    target => "@timestamp"
  }
  
  # ë¡œê·¸ ë ˆë²¨ ì¶”ì¶œ
  mutate {
    add_field => {
      "log_level" => "%{[level]}"
    }
  }
  
  # ì—ëŸ¬ ë¡œê·¸ ë¶„ì„
  if [level] == "error" {
    mutate {
      add_tag => [ "error" ]
    }
    
    # ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ íŒŒì‹±
    if [stack] {
      mutate {
        add_field => {
          "error_type" => "%{[error]}"
          "stack_trace" => "%{[stack]}"
        }
      }
    }
  }
  
  # HTTP ë¡œê·¸ ë¶„ì„
  if [method] and [url] {
    mutate {
      add_tag => [ "http" ]
    }
    
    # URL íŒŒì‹±
    grok {
      match => {
        "url" => "^(?<endpoint>/[^?]*)"
      }
    }
    
    # ëŠë¦° ìš”ì²­ íƒœê¹…
    if [responseTime] > 1000 {
      mutate {
        add_tag => [ "slow_request" ]
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "glimpse-logs-%{+YYYY.MM.dd}"
  }
  
  # ì—ëŸ¬ ì•Œë¦¼
  if "error" in [tags] {
    stdout {
      codec => rubydebug
    }
  }
}
```

### 3. êµ¬ì¡°í™”ëœ ë¡œê¹… íŒ¨í„´

#### API ìš”ì²­ ë¡œê¹…
```typescript
// ìš”ì²­ ë¡œê¹… ë¯¸ë“¤ì›¨ì–´
export const requestLogger = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  const requestId = generateRequestId();
  
  // ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
  req.context = {
    requestId,
    userId: req.user?.id,
    startTime: start,
  };
  
  // ìš”ì²­ ë¡œê¹…
  log.info('Incoming request', {
    requestId,
    method: req.method,
    path: req.path,
    query: req.query,
    userId: req.user?.id,
  });
  
  // ì‘ë‹µ ë¡œê¹…
  res.on('finish', () => {
    const duration = Date.now() - start;
    log.http(req, res, duration);
  });
  
  next();
};
```

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¡œê¹…
```typescript
// ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¡œê¹… ì˜ˆì œ
export class MatchingService {
  async createMatch(fromUserId: string, toUserId: string): Promise<Match> {
    const context = {
      action: 'create_match',
      fromUserId,
      toUserId,
      timestamp: new Date().toISOString(),
    };
    
    try {
      log.info('Creating match', context);
      
      // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
      const match = await this.prisma.match.create({
        data: {
          user1Id: fromUserId,
          user2Id: toUserId,
        },
      });
      
      log.info('Match created successfully', {
        ...context,
        matchId: match.id,
      });
      
      // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
      businessMetrics.matchesTotal.inc();
      
      return match;
    } catch (error) {
      log.error('Failed to create match', error, context);
      throw error;
    }
  }
}
```

## ğŸ¯ ì•Œë¦¼ ì„¤ì •

### 1. Prometheus ì•Œë¦¼ ê·œì¹™

#### ì•Œë¦¼ ê·œì¹™ (prometheus/alerts.yml)
```yaml
groups:
  - name: glimpse_alerts
    interval: 30s
    rules:
      # ì„œë¹„ìŠ¤ ê°€ìš©ì„±
      - alert: ServiceDown
        expr: up{job="glimpse-api"} == 0
        for: 1m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: "Service {{ $labels.instance }} is down"
          description: "{{ $labels.instance }} has been down for more than 1 minute"
      
      # ë†’ì€ ì—ëŸ¬ìœ¨
      - alert: HighErrorRate
        expr: |
          (
            sum(rate(http_requests_total{status=~"5.."}[5m]))
            /
            sum(rate(http_requests_total[5m]))
          ) > 0.05
        for: 5m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }} for the last 5 minutes"
      
      # ì‘ë‹µ ì‹œê°„
      - alert: HighResponseTime
        expr: |
          histogram_quantile(0.95,
            sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
          ) > 2
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "High response time detected"
          description: "95th percentile response time is {{ $value }}s"
      
      # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
      - alert: HighMemoryUsage
        expr: |
          (
            process_memory_usage_bytes{type="rss"}
            /
            process_memory_limit_bytes
          ) > 0.8
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value | humanizePercentage }}"
      
      # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
      - alert: DatabaseConnectionPoolExhausted
        expr: |
          (
            pg_stat_database_numbackends
            /
            pg_settings_max_connections
          ) > 0.8
        for: 5m
        labels:
          severity: warning
          team: database
        annotations:
          summary: "Database connection pool nearly exhausted"
          description: "{{ $value | humanizePercentage }} of connections are in use"
      
      # ë””ìŠ¤í¬ ê³µê°„
      - alert: DiskSpaceRunningLow
        expr: |
          (
            node_filesystem_avail_bytes{mountpoint="/"}
            /
            node_filesystem_size_bytes{mountpoint="/"}
          ) < 0.15
        for: 5m
        labels:
          severity: warning
          team: ops
        annotations:
          summary: "Disk space running low"
          description: "Only {{ $value | humanizePercentage }} disk space remaining"
```

### 2. AlertManager ì„¤ì •

#### AlertManager êµ¬ì„± (alertmanager/config.yml)
```yaml
global:
  resolve_timeout: 5m
  slack_api_url: '${SLACK_WEBHOOK_URL}'

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'
  
  routes:
    # Critical ì•Œë¦¼ì€ ì¦‰ì‹œ ì „ì†¡
    - match:
        severity: critical
      receiver: 'critical'
      group_wait: 0s
      
    # ë°ì´í„°ë² ì´ìŠ¤ ì•Œë¦¼
    - match:
        team: database
      receiver: 'database-team'
      
    # ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ ì•Œë¦¼
    - match_re:
        alertname: '^(LowMatchRate|PaymentFailure|HighChurn)$'
      receiver: 'business-team'

receivers:
  - name: 'default'
    slack_configs:
      - channel: '#alerts'
        title: 'Glimpse Alert'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        
  - name: 'critical'
    slack_configs:
      - channel: '#alerts-critical'
        title: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
    pagerduty_configs:
      - service_key: '${PAGERDUTY_SERVICE_KEY}'
        
  - name: 'database-team'
    slack_configs:
      - channel: '#database-alerts'
    email_configs:
      - to: 'database-team@glimpse.kr'
```

## ğŸ“Š ëŒ€ì‹œë³´ë“œ ë° ì‹œê°í™”

### 1. í•µì‹¬ ëŒ€ì‹œë³´ë“œ ëª©ë¡

1. **Overview Dashboard**
   - ì„œë¹„ìŠ¤ ìƒíƒœ ìš”ì•½
   - ì£¼ìš” ë©”íŠ¸ë¦­ í•œëˆˆì— ë³´ê¸°
   - ì‹¤ì‹œê°„ ì•Œë¦¼ í˜„í™©

2. **API Performance Dashboard**
   - ì—”ë“œí¬ì¸íŠ¸ë³„ ì‘ë‹µ ì‹œê°„
   - ì²˜ë¦¬ëŸ‰ ë° ì—ëŸ¬ìœ¨
   - ëŠë¦° ì¿¼ë¦¬ ë¶„ì„

3. **Business Metrics Dashboard**
   - ì¼ì¼ í™œì„± ì‚¬ìš©ì
   - ë§¤ì¹­ ì„±ê³µë¥ 
   - ìˆ˜ìµ ë° ê²°ì œ í˜„í™©
   - ì‚¬ìš©ì ì´íƒˆë¥ 

4. **Infrastructure Dashboard**
   - ì„œë²„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ 
   - ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
   - ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½

### 2. ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ ì˜ˆì œ

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ
```json
{
  "dashboard": {
    "title": "Glimpse Business Metrics",
    "panels": [
      {
        "title": "Daily Active Users",
        "targets": [{
          "expr": "sum(increase(user_activity_total[1d]))"
        }]
      },
      {
        "title": "Match Success Rate",
        "targets": [{
          "expr": "sum(rate(matches_total[1h])) / sum(rate(likes_total[1h])) * 100"
        }]
      },
      {
        "title": "Revenue (24h)",
        "targets": [{
          "expr": "sum(increase(revenue_total_krw[24h]))"
        }]
      },
      {
        "title": "Premium Conversion Rate",
        "targets": [{
          "expr": "sum(users{subscription=\"premium\"}) / sum(users) * 100"
        }]
      }
    ]
  }
}
```

## ğŸ” ë¡œê·¸ ë¶„ì„ ì¿¼ë¦¬

### Kibana ê²€ìƒ‰ ì¿¼ë¦¬ ì˜ˆì œ

```kibana
# ì—ëŸ¬ ë¡œê·¸ ê²€ìƒ‰
level:error AND timestamp:[now-1h TO now]

# íŠ¹ì • ì‚¬ìš©ìì˜ í™œë™ ì¶”ì 
userId:"user_123" AND timestamp:[now-24h TO now]

# ëŠë¦° API ìš”ì²­
tags:slow_request AND responseTime:>2000

# ê²°ì œ ì‹¤íŒ¨ ì¶”ì 
action:"payment" AND status:"failed"

# íŠ¹ì • ì—”ë“œí¬ì¸íŠ¸ ë¶„ì„
endpoint:"/api/v1/likes" AND status:[400 TO 599]
```

### ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬

```json
{
  "query": {
    "bool": {
      "must": [
        { "term": { "level": "error" } },
        { "range": { "@timestamp": { "gte": "now-1h" } } }
      ]
    }
  },
  "aggs": {
    "errors_over_time": {
      "date_histogram": {
        "field": "@timestamp",
        "interval": "5m"
      }
    },
    "top_errors": {
      "terms": {
        "field": "error_type.keyword",
        "size": 10
      }
    }
  }
}
```

## ğŸ›  íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ë©”íŠ¸ë¦­ ëˆ„ë½
```bash
# Prometheus íƒ€ê²Ÿ í™•ì¸
curl http://prometheus:9090/api/v1/targets

# ë©”íŠ¸ë¦­ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
curl http://localhost:3000/metrics

# Exporter ìƒíƒœ í™•ì¸
docker-compose ps | grep exporter
```

### 2. ë¡œê·¸ ìˆ˜ì§‘ ì‹¤íŒ¨
```bash
# Filebeat ìƒíƒœ í™•ì¸
docker-compose logs filebeat

# Logstash íŒŒì´í”„ë¼ì¸ í™•ì¸
curl -XGET 'localhost:9600/_node/pipelines?pretty'

# Elasticsearch ì¸ë±ìŠ¤ í™•ì¸
curl -XGET 'localhost:9200/_cat/indices?v'
```

### 3. ì•Œë¦¼ ë¯¸ë°œì†¡
```bash
# AlertManager ìƒíƒœ í™•ì¸
curl http://alertmanager:9093/api/v1/status

# ì•Œë¦¼ ê·œì¹™ í…ŒìŠ¤íŠ¸
promtool check rules /etc/prometheus/alerts.yml

# ì•Œë¦¼ íˆìŠ¤í† ë¦¬ í™•ì¸
curl http://alertmanager:9093/api/v1/alerts
```

## ğŸ“‹ ëª¨ë‹ˆí„°ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì¼ì¼ ì ê²€
- [ ] ëŒ€ì‹œë³´ë“œ ì£¼ìš” ì§€í‘œ í™•ì¸
- [ ] ì•Œë¦¼ ë°œìƒ í˜„í™© ê²€í† 
- [ ] ë””ìŠ¤í¬ ê³µê°„ í™•ì¸
- [ ] ë°±ì—… ìƒíƒœ í™•ì¸

### ì£¼ê°„ ì ê²€
- [ ] ì„±ëŠ¥ íŠ¸ë Œë“œ ë¶„ì„
- [ ] ë¡œê·¸ ë³´ê´€ ì •ì±… í™•ì¸
- [ ] ì•Œë¦¼ ê·œì¹™ ê²€í†  ë° ì¡°ì •
- [ ] ëŒ€ì‹œë³´ë“œ ê°œì„ ì‚¬í•­ ì ìš©

### ì›”ê°„ ì ê²€
- [ ] ë©”íŠ¸ë¦­ ë³´ê´€ ê¸°ê°„ ê²€í† 
- [ ] ëª¨ë‹ˆí„°ë§ ì¸í”„ë¼ ì—…ë°ì´íŠ¸
- [ ] ì•Œë¦¼ ë…¸ì´ì¦ˆ ë¶„ì„ ë° ê°œì„ 
- [ ] ì¸ì‹œë˜íŠ¸ ì‚¬í›„ ë¶„ì„

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### 1. ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìµœì í™”
```yaml
# ìƒ˜í”Œë§ ë ˆì´íŠ¸ ì¡°ì •
global:
  scrape_interval: 15s      # ê¸°ë³¸: 15s
  evaluation_interval: 15s   # ê¸°ë³¸: 15s
  
scrape_configs:
  - job_name: 'glimpse-api'
    scrape_interval: 10s     # APIëŠ” ë” ìì£¼
    metrics_path: '/metrics'
    static_configs:
      - targets: ['api:3000']
```

### 2. ë¡œê·¸ ìŠ¤í† ë¦¬ì§€ ìµœì í™”
```bash
# ì˜¤ë˜ëœ ì¸ë±ìŠ¤ ì •ë¦¬
curator --config curator.yml actions.yml

# ì¸ë±ìŠ¤ ìµœì í™”
curl -XPOST 'localhost:9200/glimpse-logs-*/_forcemerge?max_num_segments=1'

# ìƒ¤ë“œ ì„¤ì • ìµœì í™”
curl -XPUT 'localhost:9200/_template/glimpse_logs' -d '{
  "index_patterns": ["glimpse-logs-*"],
  "settings": {
    "number_of_shards": 2,
    "number_of_replicas": 1
  }
}'
```

## ğŸ“ ì§€ì› ë° ì—°ë½ì²˜

### ëª¨ë‹ˆí„°ë§ íŒ€
- **Slack**: #monitoring
- **Email**: monitoring@glimpse.kr
- **On-call**: +82-10-XXXX-XXXX

### ì™¸ë¶€ ì§€ì›
- **Grafana Community**: https://community.grafana.com/
- **Prometheus Users**: https://groups.google.com/g/prometheus-users
- **Elastic Forum**: https://discuss.elastic.co/