# ì¦‰ì„ ëª¨ì„ ìë™ ë§¤ì¹­ ì‹œìŠ¤í…œ

## ğŸ¯ í•µì‹¬ ì»¨ì…‰

íŠ¹ì§•ì„ ì…ë ¥í•˜ë©´ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë¶„ì„í•´ì„œ ë§¤ì¹­í•´ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ë³„ë„ì˜ í˜¸ê° í‘œí˜„ ê³¼ì • ì—†ì´ ì–‘ë°©í–¥ íŠ¹ì§• ë§¤ì¹­ì´ ì´ë£¨ì–´ì§€ë©´ ìë™ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

## ğŸ“± ì‹œë‚˜ë¦¬ì˜¤

### 1. ëª¨ì„ ì°¸ê°€ ë° íŠ¹ì§• ì…ë ¥
```
1. ëª¨ì„ ì°¸ê°€ (ë‹‰ë„¤ì„ë§Œ ì…ë ¥)
2. ë‚´ íŠ¹ì§• ì…ë ¥:
   - ìƒì˜: ê²€ì€ìƒ‰ í›„ë“œí‹°
   - í•˜ì˜: ì²­ë°”ì§€
   - ì•ˆê²½: ì°©ìš©
   - íŠ¹ë³„í•œ íŠ¹ì§•: ë…¸íŠ¸ë¶ì— ê°œë°œ ìŠ¤í‹°ì»¤
3. ì°¾ëŠ” ì‚¬ëŒ íŠ¹ì§• ì…ë ¥:
   - ìƒì˜: í°ìƒ‰ ì…”ì¸ 
   - í•˜ì˜: ë² ì´ì§€ íŒ¬ì¸ 
   - ì•ˆê²½: ë¯¸ì°©ìš©
   - íŠ¹ë³„í•œ íŠ¹ì§•: ë¶„í™ìƒ‰ í…€ë¸”ëŸ¬
```

### 2. ìë™ ë§¤ì¹­ í”„ë¡œì„¸ìŠ¤
```
ì‹œìŠ¤í…œì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ:
1. Aê°€ ì…ë ¥í•œ "ì°¾ëŠ” íŠ¹ì§•"ê³¼ Bì˜ "ë‚´ íŠ¹ì§•" ë¹„êµ
2. Bê°€ ì…ë ¥í•œ "ì°¾ëŠ” íŠ¹ì§•"ê³¼ Aì˜ "ë‚´ íŠ¹ì§•" ë¹„êµ
3. ì–‘ë°©í–¥ ì¼ì¹˜ ì‹œ ìë™ ë§¤ì¹­
4. ë§¤ì¹­ ì•Œë¦¼ ì „ì†¡
```

### 3. ë§¤ì¹­ í›„
```
1. "ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤!" ì•Œë¦¼
2. ìƒëŒ€ë°© ë‹‰ë„¤ì„ë§Œ ê³µê°œ
3. ìµëª… ì±„íŒ… ì‹œì‘
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (ìˆ˜ì •)

```sql
-- ì¦‰ì„ ì°¸ê°€ì íŠ¹ì§• (í™•ì¥)
CREATE TABLE instant_participant_features (
  id UUID PRIMARY KEY,
  participant_id UUID REFERENCES instant_participants(id),
  -- ë‚´ íŠ¹ì§•
  my_features JSONB NOT NULL,
  -- ì°¾ëŠ” ì‚¬ëŒ íŠ¹ì§•
  looking_for_features JSONB NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(participant_id)
);

-- ìë™ ë§¤ì¹­ í…Œì´ë¸” (ìˆ˜ì •)
CREATE TABLE instant_auto_matches (
  id UUID PRIMARY KEY,
  meeting_id UUID REFERENCES instant_meetings(id),
  participant1_id UUID REFERENCES instant_participants(id),
  participant2_id UUID REFERENCES instant_participants(id),
  match_score FLOAT, -- ë§¤ì¹­ ì ìˆ˜ (ì„ íƒ)
  chat_room_id UUID DEFAULT gen_random_uuid(),
  matched_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(participant1_id, participant2_id)
);

-- ë§¤ì¹­ ì‹œë„ ë¡œê·¸ (ë¶„ì„ìš©)
CREATE TABLE instant_match_attempts (
  id UUID PRIMARY KEY,
  meeting_id UUID REFERENCES instant_meetings(id),
  participant_id UUID REFERENCES instant_participants(id),
  potential_matches INTEGER, -- ê°€ëŠ¥í•œ ë§¤ì¹­ ìˆ˜
  successful_matches INTEGER, -- ì„±ê³µí•œ ë§¤ì¹­ ìˆ˜
  created_at TIMESTAMP DEFAULT NOW()
);
```

## ğŸ”§ ìë™ ë§¤ì¹­ ë¡œì§

```typescript
class AutoMatchingService {
  // íŠ¹ì§• ì…ë ¥/ìˆ˜ì • ì‹œ ìë™ ë§¤ì¹­ ì‹¤í–‰
  async updateFeaturesAndMatch(
    participantId: string,
    myFeatures: Features,
    lookingForFeatures: Features
  ) {
    // 1. íŠ¹ì§• ì €ì¥
    await this.saveFeatures(participantId, myFeatures, lookingForFeatures);
    
    // 2. ìë™ ë§¤ì¹­ ì‹¤í–‰
    const matches = await this.findMatches(participantId);
    
    // 3. ë§¤ì¹­ ê²°ê³¼ ì²˜ë¦¬
    for (const match of matches) {
      await this.createAutoMatch(participantId, match.participantId);
    }
    
    return matches.length;
  }

  // ì–‘ë°©í–¥ ë§¤ì¹­ ì°¾ê¸°
  private async findMatches(participantId: string): Promise<Match[]> {
    const myData = await this.getParticipantFeatures(participantId);
    const otherParticipants = await this.getOtherParticipants(
      myData.meetingId, 
      participantId
    );
    
    const matches = [];
    
    for (const other of otherParticipants) {
      // ì–‘ë°©í–¥ ì²´í¬
      const iMatch = this.checkFeatureMatch(
        myData.lookingFor, 
        other.myFeatures
      );
      const theyMatch = this.checkFeatureMatch(
        other.lookingFor, 
        myData.myFeatures
      );
      
      if (iMatch && theyMatch) {
        matches.push(other);
      }
    }
    
    return matches;
  }

  // íŠ¹ì§• ë§¤ì¹­ ì²´í¬
  private checkFeatureMatch(
    lookingFor: Features,
    actual: Features
  ): boolean {
    // í•„ìˆ˜ íŠ¹ì§• ì²´í¬
    if (lookingFor.upperWear && lookingFor.upperWear !== actual.upperWear) {
      return false;
    }
    if (lookingFor.lowerWear && lookingFor.lowerWear !== actual.lowerWear) {
      return false;
    }
    if (lookingFor.glasses !== null && lookingFor.glasses !== actual.glasses) {
      return false;
    }
    
    // íŠ¹ë³„í•œ íŠ¹ì§•ì€ í¬í•¨ ì—¬ë¶€ë¡œ ì²´í¬
    if (lookingFor.specialFeatures) {
      const lookingWords = this.extractKeywords(lookingFor.specialFeatures);
      const actualWords = this.extractKeywords(actual.specialFeatures || '');
      
      // í‚¤ì›Œë“œ ë§¤ì¹­
      const matchCount = lookingWords.filter(word => 
        actualWords.includes(word)
      ).length;
      
      // 50% ì´ìƒ ë§¤ì¹­ ì‹œ í†µê³¼
      if (matchCount < lookingWords.length * 0.5) {
        return false;
      }
    }
    
    return true;
  }
}
```

## ğŸ“± ìˆ˜ì •ëœ UI í”Œë¡œìš°

### 1. ëª¨ì„ ì°¸ê°€ ì‹œ íŠ¹ì§• ì…ë ¥
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < ì¦‰ì„ ëª¨ì„ ì°¸ê°€          1/3  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ì»¤í”¼ëŸ¬ë²„                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚         [ ë‹¤ìŒ ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < ë‚´ íŠ¹ì§• ì…ë ¥           2/3   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ë‹¤ë¥¸ ì‚¬ëŒì´ ë‚˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ â”‚
â”‚  í˜„ì¬ ëª¨ìŠµì„ ì…ë ¥í•´ì£¼ì„¸ìš”       â”‚
â”‚                                 â”‚
â”‚  ìƒì˜: [ê²€ì€ìƒ‰ í›„ë“œí‹° â–¼]        â”‚
â”‚  í•˜ì˜: [ì²­ë°”ì§€ â–¼]              â”‚
â”‚  ì•ˆê²½: (â€¢) ì°©ìš© ( ) ë¯¸ì°©ìš©     â”‚
â”‚                                 â”‚
â”‚  íŠ¹ë³„í•œ íŠ¹ì§•:                   â”‚
â”‚  [ë…¸íŠ¸ë¶ì— ê°œë°œ ìŠ¤í‹°ì»¤         ]â”‚
â”‚                                 â”‚
â”‚         [ ë‹¤ìŒ ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < ì°¾ëŠ” ì‚¬ëŒ íŠ¹ì§•         3/3   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ë§Œë‚˜ê³  ì‹¶ì€ ì‚¬ëŒì˜ íŠ¹ì§•ì„      â”‚
â”‚  ì…ë ¥í•´ì£¼ì„¸ìš”                   â”‚
â”‚                                 â”‚
â”‚  ìƒì˜: [í°ìƒ‰ ì…”ì¸  â–¼]           â”‚
â”‚  í•˜ì˜: [ë² ì´ì§€ íŒ¬ì¸  â–¼]         â”‚
â”‚  ì•ˆê²½: ( ) ì°©ìš© (â€¢) ë¯¸ì°©ìš©     â”‚
â”‚                                 â”‚
â”‚  íŠ¹ë³„í•œ íŠ¹ì§•:                   â”‚
â”‚  [ë¶„í™ìƒ‰ í…€ë¸”ëŸ¬               ]â”‚
â”‚                                 â”‚
â”‚      [ ì™„ë£Œ ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ëª¨ì„ ë©”ì¸ í™”ë©´ (ìˆ˜ì •)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < ìŠ¤íƒ€ë²…ìŠ¤ ê°•ë‚¨ì  ëª¨ì„    âš™ï¸   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ì°¸ê°€ì 12ëª… | ë§¤ì¹­ ëŒ€ê¸° ì¤‘...  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    ğŸ”„ ìë™ ë§¤ì¹­ ì¤‘       â”‚   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚  ë‚´ íŠ¹ì§•ê³¼ ì°¾ëŠ” ì‚¬ëŒ     â”‚   â”‚
â”‚  â”‚  íŠ¹ì§•ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  ë‚´ ë§¤ì¹­: 0                     â”‚
â”‚  ë‚¨ì€ ì‹œê°„: 2ì‹œê°„ 15ë¶„          â”‚
â”‚                                 â”‚
â”‚  [ íŠ¹ì§• ìˆ˜ì •í•˜ê¸° ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ë§¤ì¹­ ì•Œë¦¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚      ğŸ‰ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤!         â”‚
â”‚                                 â”‚
â”‚  ì„œë¡œì˜ íŠ¹ì§•ì´ ì¼ì¹˜í–ˆì–´ìš”       â”‚
â”‚                                 â”‚
â”‚  ë§¤ì¹­ ìƒëŒ€: ì±…ë²Œë ˆ              â”‚
â”‚                                 â”‚
â”‚  [ ì±„íŒ… ì‹œì‘í•˜ê¸° ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

```typescript
// WebSocket ì´ë²¤íŠ¸
socket.on('instant:feature_updated', ({ participantId }) => {
  // ë‹¤ë¥¸ ì°¸ê°€ìê°€ íŠ¹ì§•ì„ ì—…ë°ì´íŠ¸í–ˆì„ ë•Œ
  // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¬ë§¤ì¹­ ì‹œë„
});

socket.on('instant:new_match', ({ matchId, nickname }) => {
  // ìƒˆë¡œìš´ ë§¤ì¹­ ë°œìƒ
  showNotification(`${nickname}ë‹˜ê³¼ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤!`);
});

socket.on('instant:participant_joined', ({ count }) => {
  // ìƒˆ ì°¸ê°€ì ì…ì¥ ì‹œ ìë™ ë§¤ì¹­ ì¬ì‹œë„
});
```

## ğŸ›¡ï¸ í”„ë¼ì´ë²„ì‹œ ë³´í˜¸

1. **íŠ¹ì§• ë°ì´í„° ë³´í˜¸**
   - íŠ¹ì§• ì •ë³´ëŠ” ëª¨ì„ ì¢…ë£Œ í›„ 24ì‹œê°„ ë‚´ ì‚­ì œ
   - ë§¤ì¹­ëœ ìƒëŒ€ì—ê²Œë„ êµ¬ì²´ì  íŠ¹ì§• ë¹„ê³µê°œ
   - ë‹‰ë„¤ì„ë§Œ ê³µê°œ

2. **ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ë³´ì•ˆ**
   - ì •í™•í•œ ë§¤ì¹­ ë¡œì§ ë¹„ê³µê°œ
   - ë¬´ì‘ìœ„ ì¶”ì¸¡ ë°©ì§€
   - ê³¼ë„í•œ íŠ¹ì§• ë³€ê²½ ì œí•œ

## ğŸ“Š í†µê³„ (ë‚´ë¶€ìš©)

- í‰ê·  ë§¤ì¹­ ì‹œê°„
- íŠ¹ì§• ì¡°í•©ë³„ ì„±ê³µë¥ 
- ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” íŠ¹ì§•
- ë§¤ì¹­ ì„±ê³µë¥  í–¥ìƒì„ ìœ„í•œ ë¶„ì„

---

ì´ ì‹œìŠ¤í…œì„ í†µí•´ ì‚¬ìš©ìëŠ” ë³„ë„ì˜ ì•¡ì…˜ ì—†ì´ë„ ìë™ìœ¼ë¡œ ì›í•˜ëŠ” ì‚¬ëŒê³¼ ë§¤ì¹­ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.